// <autogenerated />
namespace HardcodedExample.Repositories
{
    #pragma warning disable // See configuration setting CommonConcepts:CompilerWarningsInGeneratedCode.

    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Text;
    using System.Linq.Expressions;
    using System.Runtime.Serialization;
    using Rhetos.Dom.DefaultConcepts;
    using Rhetos.Utilities;

    /*ModuleInfo Using HardcodedExample*/

    public class ModuleRepository
    {
        private readonly Rhetos.Extensibility.INamedPlugins<IRepository> _repositories;

        public ModuleRepository(Rhetos.Extensibility.INamedPlugins<IRepository> repositories)
        {
            _repositories = repositories;
        }

        private Genre_Repository _Genre_Repository;
        public Genre_Repository Genre { get { return _Genre_Repository ?? (_Genre_Repository = (Genre_Repository)Rhetos.Extensibility.NamedPluginsExtensions.GetPlugin(_repositories, @"HardcodedExample.Genre")); } }

        /*ModuleInfo RepositoryMembers HardcodedExample*/
    }

    /*DataStructureInfo RepositoryAttributes HardcodedExample.Genre*/
    public partial class Genre_Repository : /*DataStructureInfo OverrideBaseType HardcodedExample.Genre*/ Common.OrmRepositoryBase<Common.Queryable.HardcodedExample_Genre, HardcodedExample.Genre> // Common.QueryableRepositoryBase<Common.Queryable.HardcodedExample_Genre, HardcodedExample.Genre> // Common.ReadableRepositoryBase<HardcodedExample.Genre> // global::Common.RepositoryBase
        , IWritableRepository<HardcodedExample.Genre>, IValidateRepository/*DataStructureInfo RepositoryInterface HardcodedExample.Genre*/
    {
        private readonly Rhetos.Utilities.ILocalizer<HardcodedExample.Genre> _localizer;
        private readonly Rhetos.Utilities.ISqlUtility _sqlUtility;
        /*DataStructureInfo RepositoryPrivateMembers HardcodedExample.Genre*/

        public Genre_Repository(Common.DomRepository domRepository, Common.ExecutionContext executionContext, Rhetos.Utilities.ILocalizer<HardcodedExample.Genre> _localizer, Rhetos.Utilities.ISqlUtility _sqlUtility/*DataStructureInfo RepositoryConstructorArguments HardcodedExample.Genre*/)
        {
            _domRepository = domRepository;
            _executionContext = executionContext;
            this._localizer = _localizer;
            this._sqlUtility = _sqlUtility;
            /*DataStructureInfo RepositoryConstructorCode HardcodedExample.Genre*/
        }

        public static KeyValuePair<string, Type>[] GetReadParameterTypes()
        {
            return new KeyValuePair<string, Type>[]
            {
                /*DataStructureInfo ReadParameterTypes HardcodedExample.Genre*/
            };
        }
        
        public virtual void Save(IEnumerable<HardcodedExample.Genre> insertedNew, IEnumerable<HardcodedExample.Genre> updatedNew, IEnumerable<HardcodedExample.Genre> deletedIds, bool checkUserPermissions = false)
        {
            if (!DomHelper.InitializeSaveMethodItems(ref insertedNew, ref updatedNew, ref deletedIds))
                return;

            /*DataStructureInfo WritableOrm ClearContext HardcodedExample.Genre*/

            throw new Rhetos.UserException("It is not allowed to modify hard-coded data in {0}.", new [] { _localizer["HardcodedExample.Genre"] }, null, null);
            /*DataStructureInfo WritableOrm ArgumentValidation HardcodedExample.Genre*/

            /*DataStructureInfo WritableOrm Initialization HardcodedExample.Genre*/

            // Using old data, including lazy loading of navigation properties:

            IEnumerable<Common.Queryable.HardcodedExample_Genre> deleted = DomHelper.LoadOldDataWithNavigationProperties(deletedIds, this);
            IEnumerable<Common.Queryable.HardcodedExample_Genre> updated = DomHelper.LoadOldDataWithNavigationProperties(updatedNew, this);

            foreach (var newItem in insertedNew.Concat(updatedNew))
                ShortStringPropertyCodeGenerator.CheckMaxLength(newItem.Label, newItem, "HardcodedExample", "Genre", "Label");

            foreach (var newItem in insertedNew.Concat(updatedNew))
                ShortStringPropertyCodeGenerator.CheckMaxLength(newItem.Name, newItem, "HardcodedExample", "Genre", "Name");

            /*DataStructureInfo WritableOrm OldDataLoaded HardcodedExample.Genre*/

            /*DataStructureInfo WritableOrm ProcessedOldData HardcodedExample.Genre*/

            {
                DomHelper.WriteToDatabase(insertedNew, updatedNew, deletedIds, _executionContext.PersistenceStorage, checkUserPermissions, _sqlUtility,
                    out Exception saveException, out Rhetos.RhetosException interpretedException);

                if (saveException != null)
                {
                    /*DataStructureInfo WritableOrm OnDatabaseError HardcodedExample.Genre*/
                    DomHelper.ThrowInterpretedException(checkUserPermissions, saveException, interpretedException, _sqlUtility, "HardcodedExample.Genre");
                }
            }

            deleted = null;
            updated = this.Query(updatedNew.Select(item => item.ID));
            IEnumerable<Common.Queryable.HardcodedExample_Genre> inserted = this.Query(insertedNew.Select(item => item.ID));

            bool allEffectsCompleted = false;
            try
            {
                /*DataStructureInfo WritableOrm OnSaveTag1 HardcodedExample.Genre*/

                /*DataStructureInfo WritableOrm OnSaveTag2 HardcodedExample.Genre*/

                Rhetos.Dom.DefaultConcepts.InvalidDataMessage.ValidateOnSave(insertedNew, updatedNew, this, "HardcodedExample.Genre");

                /*DataStructureInfo WritableOrm AfterSave HardcodedExample.Genre*/

                allEffectsCompleted = true;
            }
            finally
            {
                if (!allEffectsCompleted)
                    _executionContext.PersistenceTransaction.DiscardOnDispose();
            }
        }

        public IEnumerable<Rhetos.Dom.DefaultConcepts.InvalidDataMessage> Validate(IList<Guid> ids, bool onSave)
        {
            /*DataStructureInfo WritableOrm OnSaveValidate HardcodedExample.Genre*/
            yield break;
        }

        /*DataStructureInfo RepositoryMembers HardcodedExample.Genre*/
    }

    /*ModuleInfo HelperNamespaceMembers HardcodedExample*/

    #pragma warning restore // See configuration setting CommonConcepts:CompilerWarningsInGeneratedCode.
}

